<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MimuGPT is an AI chatbot that helps you with smart conversations. Try it now!">
    <meta name="keywords" content="MimuGPT, AI chatbot, best AI assistant, GPT chatbot">
    <meta name="author" content="Arafat Hossain">
    <title>MimuGPT - AI Chat</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #f4f4f4; }
        .chat-container { width: 100%; height: 100vh; background: white; display: flex; flex-direction: column; position: relative; }
        .chat-header { background: #2D4051; color: white; text-align: center; padding: 15px; font-size: 20px; font-weight: bold; position: relative; }
        
        /* About  Icon Design */
        .about-icon {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 28px;
            height: 28px;
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Mobile View - Smaller 'about' Icon */
        @media (max-width: 600px) {
            .about-icon {
                width: 22px;
                height: 22px;
                font-size: 14px;
            }
        }

        .chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; position: relative; }
        .welcome-message { text-align: center; color: gray; font-size: 18px; font-weight: bold; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: opacity 0.3s; }
        .message { max-width: 70%; padding: 10px; margin: 8px; border-radius: 10px; font-size: 14px; word-wrap: break-word; opacity: 0; animation: fadeIn 0.5s forwards; }
        .user { align-self: flex-end; background: #007bff; color: white; }
        .ai { align-self: flex-start; background: #e1e1e1; color: black; }

        .chat-input { display: flex; padding: 10px; background: white; border-top: 1px solid #ddd; position: sticky; bottom: 0; }
        .chat-input input { flex: 1; padding: 10px; border: none; border-radius: 5px; outline: none; }
        .chat-input button { background: #007bff; color: white; border: none; padding: 10px 15px; margin-left: 10px; border-radius: 5px; cursor: pointer; }
        .chat-input button:hover { background: #0056b3; }

        /* Typing Animation */
        .typing-animation { display: flex; gap: 5px; }
        .typing-animation div { width: 8px; height: 8px; background-color: gray; border-radius: 50%; animation: typing 1.5s infinite; }
        .typing-animation div:nth-child(1) { animation-delay: 0s; }
        .typing-animation div:nth-child(2) { animation-delay: 0.2s; }
        .typing-animation div:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing { 
            0% { opacity: 0.3; } 
            50% { opacity: 1; } 
            100% { opacity: 0.3; } 
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="chat-container">
        <div class="chat-header">
            MimuGPT
            <div class="about-icon" onclick="redirectToAbout()">i</div>
        </div>
        <div class="chat-box" id="chatBox">
            <div class="welcome-message" id="welcomeMsg">Hello, I'm MimuGPT! Your AI assistant. How can I help you today?</div>
        </div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Type a message..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // Array to store conversation history
        let conversationHistory = [];

        function redirectToAbout() {
            setTimeout(() => {
                window.location.href = "about.html";
            }, 100); // 0.1 sec delay before opening about.html
        }

        // Function to add message to conversation history
        function addToHistory(userMessage, aiMessage) {
            conversationHistory.push({
                user: userMessage,
                ai: aiMessage
            });

            // Keep only the last 10 interactions
            if (conversationHistory.length > 10) {
                conversationHistory = conversationHistory.slice(-10);
            }
        }

        // Function to format conversation history for API
        function formatHistoryForAPI(currentUserMessage) {
            let formattedHistory = "";
            
            // Add previous interactions
            for (let i = 0; i < conversationHistory.length; i++) {
                formattedHistory += `user: ${conversationHistory[i].user}\nyou: ${conversationHistory[i].ai}\n`;
            }
            
            // Add current user message
            formattedHistory += `user: ${currentUserMessage}`;
            
            return formattedHistory;
        }

        async function sendMessage() {
            const userInput = document.getElementById("userInput");
            const chatBox = document.getElementById("chatBox");
            const welcomeMsg = document.getElementById("welcomeMsg");

            let message = userInput.value.trim();
            if (message === "") return;

            welcomeMsg.style.display = "none";

            let userMessage = document.createElement("div");
            userMessage.className = "message user";
            userMessage.innerText = message;
            chatBox.appendChild(userMessage);
            userInput.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            let typingIndicator = document.createElement("div");
            typingIndicator.className = "message ai";
            typingIndicator.innerHTML = `<div class="typing-animation"><div></div><div></div><div></div></div>`;
            chatBox.appendChild(typingIndicator);
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                // Format the conversation history with current message
                const formattedPrompt = formatHistoryForAPI(message);
                
                // Send the formatted history to your API
                let response = await fetch(`https://test-gptt.vercel.app/api/mimuai.php?ask=${encodeURIComponent(formattedPrompt)}`);
                let data = await response.json();
                let aiResponse = data.response || "Sorry, I couldn't process your request.";

                // Add this interaction to history
                addToHistory(message, aiResponse);

                chatBox.removeChild(typingIndicator);

                let aiMessage = document.createElement("div");
                aiMessage.className = "message ai";
                chatBox.appendChild(aiMessage);

                // Character by character animation
                let i = 0;
                function typeWriter() {
                    if (i < aiResponse.length) {
                        aiMessage.innerHTML += aiResponse.charAt(i);
                        i++;
                        setTimeout(typeWriter, 20);
                    }
                }
                typeWriter();

                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (error) {
                chatBox.removeChild(typingIndicator);
                let errorMessage = document.createElement("div");
                errorMessage.className = "message ai";
                errorMessage.innerText = "Error! Unable to fetch response.";
                chatBox.appendChild(errorMessage);
            }
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        }

        // Optional: Function to clear conversation history
        function clearHistory() {
            conversationHistory = [];
            console.log("Conversation history cleared");
        }

        // Optional: Function to view current history (for debugging)
        function viewHistory() {
            console.log("Current conversation history:", conversationHistory);
            console.log("Formatted for API:", formatHistoryForAPI("test message"));
        }
    </script>
</body>
</html>